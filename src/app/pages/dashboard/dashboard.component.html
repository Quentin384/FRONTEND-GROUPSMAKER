<!-- src/app/pages/dashboard/dashboard.component.html -->
<div class="dashboard">
  <!-- Bouton Admin -->
  <button
    *ngIf="isAdmin()"
    class="btn-admin"
    (click)="redirigerVersAdmin()"
    type="button"
  >
    ğŸ› AccÃ©der Ã  lâ€™administration
  </button>

  <h1>Vos listes</h1>

  <!-- Formulaire de crÃ©ation de liste -->
  <app-form-creer-liste (creer)="creerListe($event)"></app-form-creer-liste>

  <!-- Parcours de chaque liste -->
  <div *ngFor="let liste of listes" class="liste">
    <!-- En-tÃªte : titre + badge + supprimer -->
    <div class="liste-header">
      <h2>
        {{ liste.nom }}
        <span class="badge">{{ liste.personnes.length }} personnes</span>
      </h2>
      <button
        class="btn-supprimer"
        (click)="supprimerListe(liste.id)"
        type="button"
      >
        ğŸ—‘ Supprimer
      </button>
    </div>

    <!-- Personnes -->
    <ul *ngIf="liste.personnes.length > 0" class="liste-personnes">
      <li *ngFor="let p of liste.personnes">
        ğŸ‘¤ {{ p.nom }}
        | Genre: {{ p.genre }}
        | Tech: {{ p.niveauTechnique }}/4
        | FR: {{ p.aisanceFrancais }}/4
        | Profil: {{ p.profil }}
        | Ã‚ge: {{ p.age }} ans
      </li>
    </ul>
    <p *ngIf="liste.personnes.length === 0" class="vide">
      Aucune personne dans cette liste.
    </p>

    <!-- Ajout de personne -->
    <app-form-ajout-personne
      [idListe]="liste.id"
      (ajout)="ajouterPersonne($event)"
    ></app-form-ajout-personne>

    <!-- ParamÃ¨tres de tirage -->
    <div class="config">
      <label>
        Nombre de groupes :
        <input
          type="number"
          [(ngModel)]="nombreGroupes[liste.id]"
          name="nb-{{ liste.id }}"
          min="1"
          [max]="liste.personnes.length"
        />
      </label>
      <fieldset>
        <legend>CritÃ¨res de mixitÃ©</legend>
        <label>
          <input
            type="checkbox"
            [(ngModel)]="criteresMixite[liste.id].anciensDWWM"
            name="critAncien-{{ liste.id }}"
          />
          Anciens DWWM
        </label>
        <label>
          <input
            type="checkbox"
            [(ngModel)]="criteresMixite[liste.id].mixAge"
            name="critAge-{{ liste.id }}"
          />
          Mix Ã¢ge
        </label>
      </fieldset>
    </div>

    <!-- Lancer les groupes -->
    <button (click)="formerGroupes(liste.id)" type="button">
      Former les groupes
    </button>

    <!-- Groupes gÃ©nÃ©rÃ©s -->
    <div *ngIf="groupesFormes[liste.id]?.length" class="groupes">
      <h3>Groupes gÃ©nÃ©rÃ©s</h3>
      <div
        *ngFor="let grp of groupesFormes[liste.id]; let i = index"
        class="groupe-card"
      >
        <input
          [(ngModel)]="grp.nom"
          name="grpNom-{{ liste.id }}-{{ i }}"
          placeholder="Nom du groupe {{ i + 1 }}"
        />
        <ul>
          <li *ngFor="let p of grp.membres">{{ p.nom }}</li>
        </ul>
      </div>

      <!-- Un seul bouton de validation qui POSTERA le tirage avec valide=true -->
      <button
        class="valide"
        (click)="enregistrerTirage(liste.id)"
        type="button"
      >
        âœ… Valider le tirage
      </button>
    </div>
  </div>
</div>
